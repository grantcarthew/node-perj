function p(a,...i){let e=!1;typeof Buffer<"u"&&(e=!0);let n=2e3,l,u=new WeakSet;for(let c of i)l=0,h(a,c),l>n&&console.warn(`[Perj] Maximum of ${n} recursive calls has been reached.`);return a;function h(c,o){if(l++>n)return;if(o==null)return o;let d=typeof o;if(d==="string"||d==="number"||d==="boolean")return o;if(d==="object"){if(u.has(o))return"[Circular]";if(u.add(o),Array.isArray(o)){let s=[];for(let r=0;r<o.length;r++)s[r]=h({},o[r]);return s}if(o instanceof Date)return o;if(o instanceof Error){for(let s of Reflect.ownKeys(o)){let r=h({},o[s]);r!==void 0&&(c[s]=r)}return c.message===void 0&&(c.message="The application has encountered an unknown error."),c.name===void 0&&(c.name="Error"),c}if(e&&o instanceof Buffer){let r={type:"Buffer"};if(r.hex=o.toString("hex",0,50),r.utf8=o.toString("utf8",0,50),r.base64=o.toString("base64",0,50),o.length>50){let m="...";r.hex+=m,r.utf8+=m,r.base64+=m}return r}for(let s in o){let r=h({},o[s]);r!==void 0&&(c[s]=r)}return c}}}var O={levels:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},level:"info",levelKey:"level",levelKeyEnabled:!0,levelNumberKey:"lvl",levelNumberKeyEnabled:!0,dateTimeKey:"time",dateTimeFunction:j,messageKey:"msg",dataKey:"data",separatorString:":",serializers:!1,serializeErrorFunction:B,stringifyFunction:T,passThrough:!1,write:x()};function j(){return Date.now()}function x(){return typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]"?process.stdout.write.bind(process.stdout):console.log}function T(a,i,e){if(a==null)return null;let n=typeof a;if(n==="string")return JSON.stringify(a,i,e);if(n==="number"||n==="boolean")return a;if(Array.isArray(a)){let l="[",u=a.length-1;for(let h=0;h<a.length;h++)l+=T(a[h]),h<u&&(l+=",");return l+"]"}return JSON.stringify(p({},a),i,e)}function B(a){return p({},a)}var F=Symbol("SplitOptions"),t=Symbol("Options"),y=Symbol("TopSnip"),f=Symbol("TopValues"),g=Symbol("TopIsPrimitive"),b=Symbol("HeaderStrings"),S=Symbol("HeaderValues"),K=Symbol("SetLevelHeader"),w=Symbol("SetLevelFunction"),E=class{constructor(i){if(i!=null&&i.constructor!==Object)throw new Error("Provide options object to create a logger.");this[t]=Object.assign({},O),this[y]="",this[f]={},this[g]=!0,this[F](i),this[b]={},this[S]={};for(let e in this[t].levels)this[K](e),this[w](e)}get level(){return this[t].level}set level(i){if(!Object.hasOwn(this[t].levels,i))throw new Error("The level option must be a valid key in the levels object.");Object.hasOwn(this,t)||(this[t]=Object.assign({},this[t])),this[t].level=i}get levels(){return this[t].levels}addLevel(i){for(let e in i)this[e]||(this[t].levels[e]=i[e],this[K](e),this[w](e))}get write(){return this[t].write}[F](i){if(i)for(let e in i)if(Object.hasOwn(O,e)){if(e==="level"){this.level=i[e];continue}e==="stringifyFunction"&&(this[g]=!1),this[t][e]=i[e]}else{let n=typeof i[e];n==="string"?(this[y]+='"'+e+'":"'+i[e]+'",',this[f][e]=i[e]):n==="number"||n==="boolean"?(this[y]+='"'+e+'":'+i[e]+",",this[f][e]=i[e]):n==="undefined"?(this[y]+='"'+e+'":null,',this[f][e]=null):(this[y]+='"'+e+'":'+this[t].stringifyFunction(i[e])+",",this[f][e]=i[e],this[g]=!1)}}[K](i){if(this[b][i]="{",this[t].levelKeyEnabled&&(this[b][i]+='"'+this[t].levelKey+'":"'+i+'",'),this[t].levelNumberKeyEnabled&&(this[b][i]+='"'+this[t].levelNumberKey+'":'+this[t].levels[i]+","),this[y]!==""&&(this[b][i]+=this[y]),this[b][i]+='"'+this[t].dateTimeKey+'":',this[t].passThrough){let e={};this[t].levelKeyEnabled&&(e[this[t].levelKey]=i),this[t].levelNumberKeyEnabled&&(e[this[t].levelNumberKey]=this[t].levels[i]),this[S][i]=p(e,this[f])}}[w](i){this[i]=function(...e){if(this[t].levels[this[t].level]>this[t].levels[i])return;let n=this[t].dateTimeFunction(),l="",u=null,h="null",c=!1,o=s=>{if(!this[t].serializers)return s;if(s==null)return null;let r={};for(let m in s){let v=s[m];Object.hasOwn&&Object.hasOwn(s,m)&&this[t].serializers[m]&&(v=this[t].serializers[m](v)),v!==void 0&&(r[m]=v)}return r};if(e.length===1){let s=e[0],r=typeof s;r==="string"?l=s:s==null||r==="function"||(r==="number"||r==="boolean"?(u=s,h=""+s):s instanceof Error?(c=!0,l=s.message,u=this[t].serializeErrorFunction(s),h=this[t].stringifyFunction(u)):(u=o(s),h=this[t].stringifyFunction(u)))}else if(e.length>1){u=[];for(let s of e){let r=typeof s;if(r==="string"){l?u.push(s):l=s;continue}if(s==null||r==="function"){u.push(null);continue}if(s instanceof Error){c=!0,u.push(this[t].serializeErrorFunction(s)),l||(l=s.message);continue}u.push(o(s))}u.length===1&&(u=u[0]),h=this[t].stringifyFunction(u)}let d=this[b][i]+n+',"'+this[t].messageKey+'":"'+l+'","'+this[t].dataKey+'":'+h;if(c&&(d+=',"error":true'),d+=`}
`,this[t].passThrough){let s=p({},this[S][i],{[this[t].dateTimeKey]:n,[this[t].messageKey]:l,[this[t].dataKey]:u});c&&(s.error=!0),this[t].write(d,s)}else this[t].write(d)}}child(i){if(i==null||i.constructor!==Object)throw new Error("Provide top level arguments object to create a child logger.");let e=Object.create(this);if(this[g]){e[f]={},e[g]=!0;for(let n in this[f])e[f][n]=this[f][n]}else e[f]=p({},this[f]),e[g]=!1;for(let n in i){if(Object.hasOwn(O,n)||this[t].levelKey===n||this[t].levelNumberKey===n||this[t].dateTimeKey===n||this[t].messageKey===n||this[t].dataKey===n)continue;let l=typeof i[n];l==="string"&&Object.hasOwn(this[f],n)&&typeof this[f][n]=="string"?e[f][n]=this[f][n]+this[t].separatorString+i[n]:l==="undefined"?e[f][n]=null:(e[f][n]=i[n],l==="string"||l==="number"||l==="boolean"||(this[g]=!1))}e[y]="";for(let n in e[f]){if(e[g]){typeof e[f][n]==="string"?e[y]+='"'+n+'":"'+e[f][n]+'",':e[y]+='"'+n+'":'+e[f][n]+",";continue}e[y]+='"'+n+'":'+this[t].stringifyFunction(e[f][n])+","}e.parent=this,e[b]={},e[S]={};for(let n in this[t].levels)e[K](n);return e}stringify(i,e,n){return this[t].stringifyFunction(i,e,n)}json(i){console.log(this[t].stringifyFunction(i,null,2))}},H=E;export{E as Perj,H as default};
